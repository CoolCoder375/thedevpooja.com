<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="DevPooja Products - Browse our complete collection of Hindu worship essentials, incense, garlands, diyas and more."
    />
    <title>All Products | The Devpooja</title>
    <link rel="stylesheet" href="../css/common.css" />
    <link rel="stylesheet" href="../css/products.css" />
    <link rel="stylesheet" href="../css/cart.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;600;700&family=Noto+Sans+Devanagari:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="icon" type="image/png" href="../images/logo.png" />
  </head>
  <body>
    <header class="header">
      <nav class="nav">
        <div class="nav-logo">
          <a href="../index.html">
            <img src="../images/logo.JPG" alt="The Devpooja" class="logo-img" />
          </a>
        </div>
        <ul class="nav-menu">
          <li><a href="../index.html" class="nav-link">Home</a></li>
          <li><a href="products.html" class="nav-link active">Products</a></li>
          <li><a href="about.html" class="nav-link">About</a></li>
          <li><a href="contact.html" class="nav-link">Contact</a></li>
        </ul>
        <div class="hamburger">
          <span class="bar"></span>
          <span class="bar"></span>
          <span class="bar"></span>
        </div>
      </nav>
    </header>

    <main>
      <section class="products-listing">
        <div class="container">
          <!-- Desktop Layout: Sidebar + Products -->
          <div class="products-layout-container desktop-view">
            <!-- Desktop Left Sidebar - Filters -->
            <aside class="desktop-sidebar">
              <div class="filter-section" id="filterSectionDesktop">
                <h3>Categories</h3>
                <div class="filter-buttons desktop-filter-buttons">
                  <button class="filter-btn active" data-category="all">
                    All Products
                  </button>
                  <button class="filter-btn" data-category="incense">
                    Incense & Dhoop
                  </button>
                  <button class="filter-btn" data-category="garlands">
                    Garlands & Flowers
                  </button>
                  <button class="filter-btn" data-category="idols">
                    Idols & Statues
                  </button>
                  <button class="filter-btn" data-category="diyas">
                    Diyas & Lamps
                  </button>
                  <button class="filter-btn" data-category="pooja-items">
                    Pooja Items
                  </button>
                  <button class="filter-btn" data-category="coconuts">
                    Coconuts
                  </button>
                </div>
              </div>
            </aside>

            <!-- Desktop Main Content -->
            <div class="desktop-main-content">
              <div class="results-info">
                <div class="search-container">
                  <div class="search-box">
                    <input
                      type="text"
                      id="product-search"
                      placeholder="Search for products (e.g., Agarbatti, Diya)..."
                      aria-label="Search products"
                    />
                    <span class="search-icon">üîç</span>
                    <button
                      id="clear-search"
                      class="clear-btn"
                      aria-label="Clear search"
                    >
                      &times;
                    </button>
                  </div>
                </div>
                <span id="results-count">Showing all products</span>
              </div>

              <!-- Desktop Grid View -->
              <div class="products-grid" id="all-products">
                <!-- Products will be loaded dynamically -->
              </div>

              <!-- Desktop Pagination -->
              <div class="pagination-container" id="desktop-pagination">
                <!-- Pagination will be loaded dynamically -->
              </div>
            </div>
          </div>

          <!-- Mobile Layout: Filters Left + Products Right -->
          <div class="mobile-filter-sidebar">
            <button class="filter-toggle-btn" id="filterToggleBtn">
              <span class="filter-icon">‚ò∞</span>
            </button>
            <div
              class="filter-section mobile-filter-section"
              id="filterSection"
            >
              <h3>Filters</h3>
              <div class="filter-buttons mobile-filter-buttons">
                <button class="filter-btn active" data-category="all">
                  All
                </button>
                <button class="filter-btn" data-category="incense">
                  Incense
                </button>
                <button class="filter-btn" data-category="garlands">
                  Garlands
                </button>
                <button class="filter-btn" data-category="idols">Idols</button>
                <button class="filter-btn" data-category="diyas">Diyas</button>
                <button class="filter-btn" data-category="pooja-items">
                  Pooja
                </button>
                <button class="filter-btn" data-category="coconuts">
                  Coconuts
                </button>
              </div>
            </div>
          </div>
          <div class="mobile-view mobile-layout-wrapper">
            <!-- Mobile Filter Sidebar -->

            <!-- Mobile Products Grid -->
            <div class="mobile-products-container">
              <div class="results-info mobile-results-info">
                <div class="search-container mobile-search">
                  <div class="search-box">
                    <input
                      type="text"
                      id="mobile-product-search"
                      placeholder="Search..."
                      aria-label="Search products"
                    />
                    <span class="search-icon">üîç</span>
                    <button
                      id="mobile-clear-search"
                      class="clear-btn"
                      aria-label="Clear search"
                    >
                      &times;
                    </button>
                  </div>
                </div>
                <span id="mobile-results-count">Showing all products</span>
              </div>
              <div class="mobile-products-grid" id="mobile-products">
                <!-- Products will be loaded dynamically for mobile -->
              </div>

              <!-- Mobile Pagination -->
              <div class="pagination-container" id="mobile-pagination">
                <!-- Pagination will be loaded dynamically -->
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="footer">
      <div class="container">
        <div class="footer-content">
          <div class="footer-section">
            <img
              src="../images/logo.JPG"
              alt="The Devpooja"
              class="footer-logo"
            />
            <p>
              Your trusted source for authentic Hindu worship essentials.
              Bringing devotion to your doorstep.
            </p>
          </div>
          <div class="footer-section">
            <h4>Quick Links</h4>
            <ul>
              <li><a href="../index.html">Home</a></li>
              <li><a href="products.html">Products</a></li>
              <li><a href="about.html">About Us</a></li>
              <li><a href="contact.html">Contact</a></li>
            </ul>
          </div>
          <div class="footer-section">
            <h4>Categories</h4>
            <ul>
              <li><a href="#" data-category="diyas">Diyas & Lamps</a></li>
              <li>
                <a href="#" data-category="garlands">Garlands & Flowers</a>
              </li>
              <li><a href="#" data-category="idols">Idols & Statues</a></li>
              <li><a href="#" data-category="incense">Incense & Dhoop</a></li>
            </ul>
          </div>
          <div class="footer-section">
            <h4>Customer Care</h4>
            <ul>
              <li><a href="#">Shipping Info</a></li>
              <li><a href="#">Return Policy</a></li>
              <li><a href="#">FAQ</a></li>
              <li><a href="#">Support</a></li>
            </ul>
          </div>
        </div>
        <div class="footer-bottom">
          <p>
            &copy; 2024 The Devpooja. All rights reserved. | Crafted with
            devotion üôè
          </p>
        </div>
      </div>
    </footer>

    <script
      src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"
      defer
    ></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script src="../js/config.js" defer></script>
    <script src="../js/products.js" defer></script>
    <script src="../js/cart.js" defer></script>
    <script defer>
      document.addEventListener("productsLoaded", function () {
        const productsContainer = document.getElementById("all-products");
        const mobileProductsContainer =
          document.getElementById("mobile-products");
        const desktopFilterButtons = document.querySelectorAll(
          ".desktop-filter-buttons .filter-btn",
        );
        const mobileFilterButtons = document.querySelectorAll(
          ".mobile-filter-buttons .filter-btn",
        );
        const resultsCount = document.getElementById("results-count");
        const mobileResultsCount = document.getElementById(
          "mobile-results-count",
        );
        const desktopPagination = document.getElementById("desktop-pagination");
        const mobilePagination = document.getElementById("mobile-pagination");

        // Pagination state
        let currentPage = 1;
        const itemsPerPage = 10;
        let currentCategory = "all";
        let allProductsToShow = [];

        // Search functionality
        const desktopSearchInput = document.getElementById("product-search");
        const mobileSearchInput = document.getElementById(
          "mobile-product-search",
        );
        const desktopClearBtn = document.getElementById("clear-search");
        const mobileClearBtn = document.getElementById("mobile-clear-search");
        let searchQuery = "";

        function handleSearch(e) {
          searchQuery = e.target.value.toLowerCase().trim();

          // Sync search inputs
          if (e.target === desktopSearchInput) {
            if (mobileSearchInput) mobileSearchInput.value = e.target.value;
          } else {
            if (desktopSearchInput) desktopSearchInput.value = e.target.value;
          }

          // Show/hide clear buttons
          if (searchQuery) {
            if (desktopClearBtn) desktopClearBtn.style.display = "flex";
            if (mobileClearBtn) mobileClearBtn.style.display = "flex";
          } else {
            if (desktopClearBtn) desktopClearBtn.style.display = "none";
            if (mobileClearBtn) mobileClearBtn.style.display = "none";
          }

          currentPage = 1;
          loadProducts(currentCategory);
        }

        if (desktopSearchInput)
          desktopSearchInput.addEventListener("input", handleSearch);
        if (mobileSearchInput)
          mobileSearchInput.addEventListener("input", handleSearch);

        function clearSearch() {
          searchQuery = "";
          if (desktopSearchInput) desktopSearchInput.value = "";
          if (mobileSearchInput) mobileSearchInput.value = "";
          if (desktopClearBtn) desktopClearBtn.style.display = "none";
          if (mobileClearBtn) mobileClearBtn.style.display = "none";
          currentPage = 1;
          loadProducts(currentCategory);
        }

        if (desktopClearBtn)
          desktopClearBtn.addEventListener("click", clearSearch);
        if (mobileClearBtn)
          mobileClearBtn.addEventListener("click", clearSearch);

        function loadProducts(category) {
          currentCategory = category;

          let baseProducts = [];
          if (category === "all") {
            baseProducts = products;
          } else {
            baseProducts = getProductsByCategory(category);
          }

          // Apply search filter
          if (searchQuery) {
            allProductsToShow = baseProducts.filter(
              (product) =>
                product.name.toLowerCase().includes(searchQuery) ||
                product.description.toLowerCase().includes(searchQuery) ||
                (product.features &&
                  product.features.some((f) =>
                    f.toLowerCase().includes(searchQuery),
                  )),
            );
          } else {
            allProductsToShow = baseProducts;
          }

          renderProductsPage();
          renderPagination();
        }

        // Load all products initially
        loadProducts("all");

        // Desktop filter functionality
        desktopFilterButtons.forEach((button) => {
          button.addEventListener("click", function () {
            desktopFilterButtons.forEach((btn) =>
              btn.classList.remove("active"),
            );
            this.classList.add("active");

            const category = this.getAttribute("data-category");
            currentPage = 1; // Reset to first page when filtering
            loadProducts(category);
          });
        });

        // Mobile filter functionality
        mobileFilterButtons.forEach((button) => {
          button.addEventListener("click", function () {
            mobileFilterButtons.forEach((btn) =>
              btn.classList.remove("active"),
            );
            this.classList.add("active");

            const category = this.getAttribute("data-category");
            currentPage = 1;
            loadProducts(category);
          });
        });

        function renderProductsPage() {
          const totalProducts = allProductsToShow.length;
          const startIndex = (currentPage - 1) * itemsPerPage;
          const endIndex = startIndex + itemsPerPage;
          const productsToShow = allProductsToShow.slice(startIndex, endIndex);

          // Update results count
          let countText = "";
          let mobileCountText = "";

          const categoryName =
            currentCategory === "all"
              ? ""
              : ` in ${categories[currentCategory] || currentCategory}`;
          const searchText = searchQuery ? ` matching "${searchQuery}"` : "";

          if (totalProducts === 0) {
            countText = `No products found${searchText}${categoryName}`;
            mobileCountText = "No results";
          } else {
            const rangeText = `${startIndex + 1}-${Math.min(endIndex, totalProducts)} of ${totalProducts}`;
            countText = `Showing ${rangeText} products${searchText}${categoryName}`;
            mobileCountText = rangeText;
          }

          if (resultsCount) resultsCount.textContent = countText;
          if (mobileResultsCount)
            mobileResultsCount.textContent = mobileCountText;

          if (productsToShow.length === 0) {
            productsContainer.innerHTML =
              '<p class="no-products">No products found in this category.</p>';
            mobileProductsContainer.innerHTML =
              '<p class="no-products">No products found.</p>';
          } else {
            // Desktop grid - 3 column portrait card layout
            productsContainer.innerHTML = productsToShow
              .map((product) => {
                const quantity = parseInt(product.quantity) || 0;
                const isOutOfStock = quantity === 0;
                const isLowStock = quantity > 0 && quantity <= 5;

                let stockBadge = "";
                if (isOutOfStock) {
                  stockBadge =
                    '<div class="stock-badge out-of-stock">Out of Stock</div>';
                } else if (isLowStock) {
                  stockBadge = `<div class="stock-badge low-stock">Only ${quantity} left!</div>`;
                }

                const addToCartBtn = isOutOfStock
                  ? '<button class="btn btn-primary btn-add-cart" disabled style="background: #ccc; cursor: not-allowed;">Out of Stock</button>'
                  : `<button class="btn btn-primary btn-add-cart" onclick="addToCartWithQty(${product.id})">Add to Cart</button>`;

                const quantitySelector = isOutOfStock
                  ? '<div class="quantity-selector" style="opacity: 0.5; pointer-events: none;"><button class="qty-btn qty-minus" disabled>-</button><input type="number" class="qty-input" value="1" min="1" max="1" readonly disabled><button class="qty-btn qty-plus" disabled>+</button></div>'
                  : `<div class="quantity-selector"><button class="qty-btn qty-minus" onclick="decrementQty(${product.id})" aria-label="Decrease quantity">-</button><input type="number" id="qty-${product.id}" class="qty-input" value="1" min="1" max="${quantity}" readonly><button class="qty-btn qty-plus" onclick="incrementQty(${product.id})" aria-label="Increase quantity">+</button></div>`;

                return `<div class="desktop-product-card ${isOutOfStock ? "out-of-stock" : ""}" data-category="${product.category}">
                            ${stockBadge}
                            <div class="desktop-product-image" onclick="window.location.href='product-detail.html?id=${product.id}'">
                                <img src="${product.image}" alt="${product.name}" loading="lazy">
                            </div>
                            <div class="desktop-product-info">
                                <h3 onclick="window.location.href='product-detail.html?id=${product.id}'">${product.name}</h3>
                                <p>${product.description}</p>
                                <div class="product-features">
                                    ${product.features.map((feature) => `<span class="feature-tag">${feature}</span>`).join("")}
                                </div>
                            </div>
                        </div>`;
              })
              .join("");

            // Mobile grid - portrait cards
            mobileProductsContainer.innerHTML = productsToShow
              .map(
                (product) =>
                  `<div class="mobile-product-card" data-category="${product.category}">
                            <div class="mobile-product-image" style="cursor: pointer;" onclick="window.location.href='product-detail.html?id=${product.id}'">
                                <img src="${product.image}" alt="${product.name}" loading="lazy">
                            </div>
                            <div class="mobile-product-info">
                                <h3 style="cursor: pointer;" onclick="window.location.href='product-detail.html?id=${product.id}'">${product.name}</h3>
                                <p>${product.description}</p>
                                <div class="product-price">‚Çπ${product.price}</div>
                                <div class="product-actions">
                                    <div class="quantity-selector">
                                        <button class="qty-btn qty-minus" onclick="decrementQty(${product.id}, 'mobile')" aria-label="Decrease quantity">-</button>
                                        <input type="number" id="qty-mobile-${product.id}" class="qty-input" value="1" min="1" max="${product.quantity || 999}" readonly>
                                        <button class="qty-btn qty-plus" onclick="incrementQty(${product.id}, 'mobile')" aria-label="Increase quantity">+</button>
                                    </div>
                                    <button class="btn btn-primary btn-add-cart" onclick="addToCartWithQty(${product.id}, 'mobile')">Add to Cart</button>
                                </div>
                            </div>
                        </div>`,
              )
              .join("");
          }

          // Scroll to top of products section
          window.scrollTo({ top: 0, behavior: "smooth" });
        }

        function renderPagination() {
          const totalPages = Math.ceil(allProductsToShow.length / itemsPerPage);

          if (totalPages <= 1) {
            desktopPagination.innerHTML = "";
            mobilePagination.innerHTML = "";
            return;
          }

          let paginationHTML = '<div class="pagination">';

          // Previous button
          paginationHTML += `<button class="pagination-btn ${currentPage === 1 ? "disabled" : ""}"
                    onclick="goToPage(${currentPage - 1})" ${currentPage === 1 ? "disabled" : ""}>
                    ¬´ Previous
                </button>`;

          // Page numbers
          const maxVisiblePages = 5;
          let startPage = Math.max(
            1,
            currentPage - Math.floor(maxVisiblePages / 2),
          );
          let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

          if (endPage - startPage < maxVisiblePages - 1) {
            startPage = Math.max(1, endPage - maxVisiblePages + 1);
          }

          if (startPage > 1) {
            paginationHTML += `<button class="pagination-btn" onclick="goToPage(1)">1</button>`;
            if (startPage > 2) {
              paginationHTML += `<span class="pagination-dots">...</span>`;
            }
          }

          for (let i = startPage; i <= endPage; i++) {
            paginationHTML += `<button class="pagination-btn ${i === currentPage ? "active" : ""}"
                        onclick="goToPage(${i})">${i}</button>`;
          }

          if (endPage < totalPages) {
            if (endPage < totalPages - 1) {
              paginationHTML += `<span class="pagination-dots">...</span>`;
            }
            paginationHTML += `<button class="pagination-btn" onclick="goToPage(${totalPages})">${totalPages}</button>`;
          }

          // Next button
          paginationHTML += `<button class="pagination-btn ${currentPage === totalPages ? "disabled" : ""}"
                    onclick="goToPage(${currentPage + 1})" ${currentPage === totalPages ? "disabled" : ""}>
                    Next ¬ª
                </button>`;

          paginationHTML += "</div>";

          desktopPagination.innerHTML = paginationHTML;
          mobilePagination.innerHTML = paginationHTML;
        }

        // Make goToPage function globally accessible
        window.goToPage = function (page) {
          const totalPages = Math.ceil(allProductsToShow.length / itemsPerPage);
          if (page < 1 || page > totalPages) return;

          currentPage = page;
          renderProductsPage();
          renderPagination();
        };
      });

      // Mobile menu toggle
      const hamburger = document.querySelector(".hamburger");
      const navMenu = document.querySelector(".nav-menu");

      if (hamburger && navMenu) {
        hamburger.addEventListener("click", () => {
          hamburger.classList.toggle("active");
          navMenu.classList.toggle("active");
        });

        document.querySelectorAll(".nav-link").forEach((n) =>
          n.addEventListener("click", () => {
            hamburger.classList.remove("active");
            navMenu.classList.remove("active");
          }),
        );
      }

      // Filter toggle for mobile
      const filterToggleBtn = document.getElementById("filterToggleBtn");
      const filterSection = document.getElementById("filterSection");

      if (filterToggleBtn && filterSection) {
        filterToggleBtn.addEventListener("click", () => {
          filterToggleBtn.classList.toggle("active");
          filterSection.classList.toggle("active");
        });

        // Close filter menu when a filter is selected on mobile
        const mobileFilterButtons = document.querySelectorAll(
          ".mobile-filter-buttons .filter-btn",
        );
        mobileFilterButtons.forEach((btn) => {
          btn.addEventListener("click", () => {
            // Auto-close filter menu after selection
            setTimeout(() => {
              filterSection.classList.remove("active");
              filterToggleBtn.classList.remove("active");
            }, 300);
          });
        });
      }
    </script>
  </body>
</html>
